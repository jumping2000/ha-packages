###########################################################
# SFONDO_IMMAGINE: "/local/hassiohelp/pkg_elettrodomestici/sfondo_black.png"
# GRANDEZZA_CARATTERI_BASE: "12px"
# GRANDEZZA_CARATTERI_APEX: "10px"
# ALTEZZA_LINEA: "24px"
# COLORSCHEME_RGB_RED: "#bf212f"
# COLORSCHEME_RGB_YELLOW: "#f9a73e"
# COLORSCHEME_RGB_GREEN2: "#006f3c"
# COLORSCHEME_RGB_GREEN: "#27b376"
# COLORSCHEME_RGB_BLUE: "#264b96"
###########################################################
# GRANDEZZA_CARATTERI_BUTTON_SMALL: &CONF_FONT_SIZE_SMALL "0.85em"
# GRANDEZZA_CARATTERI_BUTTON_MEDIUM: &CONF_FONT_SIZE_MEDIUM "0.95em"
# GRANDEZZA_CARATTERI_BUTTON_BIG: &CONF_FONT_SIZE_BIG "1.1em"
# COLORE_BUTTON_NAME: "var(--primary-text-color)"
# COLORE_BUTTON_LABEL: "var(--google-grey)" #"gray"
###########################################################
type: custom:button-card
styles:
  card:
    - padding: 0
    - border: none
  name:
    - padding: 0
    - width: 100%
    - font-weight: bold
  grid:
    - grid-template-areas: '"i" "n" "pictures" "buttons"'
    - grid-template-columns: 1fr
    - grid-template-rows: min-content min-content min-content
  custom_fields:
    pictures:
      - background-color: transparent
    buttons:
      - background-color: transparent
custom_fields:
  pictures:
    card:
      type: picture-elements
      style: |
        {% set stato = states('sensor.dryer_status') %}
        @keyframes idle {}
        @keyframes unknown {}
        @keyframes unavailable {}
        @keyframes asciugatura {
          0% { transform: rotate(0deg); }
          10% { transform: rotate(40deg); }
          20% { transform: rotate(80deg); }
          30% { transform: rotate(40deg); }
          40% { transform: rotate(80deg); }
          60% { transform: rotate(-40deg); }
          70% { transform: rotate(-80deg); }
          80% { transform: rotate(-40deg); }
          90% { transform: rotate(-80deg); }
          100% { transform: rotate(0deg); }
        }
        @keyframes mantenimento {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(720deg); } 
        }
        ha-card { 
          --my-animation-name: {{stato|lower}};
          --my-rotate: {{ {
                'Asciugatura' : '1800ms infinite ease-in-out backwards',
                'Mantenimento' : '1500ms infinite ease-in-out alternate backwards',
                'Idle': '',
                'unknown':'',
                'unavailable':''
                } [stato] }};
          border-radius: 0px 0px 0px 0px;
        }
      image: /local/hassiohelp/pkg_elettrodomestici/sfondo_black.png
      elements:
        - type: image
          entity: switch.plug_asciugatrice
          image: /local/hassiohelp/pkg_elettrodomestici/asciugatrice.png
          state_filter:
            'off': brightness(50%) saturate(0.5) opacity(1.0)
            'on': brightness(100%)
          style:
            left: 22%
            top: 48.5%
            width: 27%
          tap_action:
            action: toggle
        - type: image
          entity: sensor.dryer_status
          image: /local/hassiohelp/pkg_elettrodomestici/asciugatrice_oblo.png
          state_filter:
            Idle: opacity(0.0)
            Asciugatura: opacity(0.0)
            Mantenimento: opacity(0.0)
            Svuotare: null
          style:
            left: 16.5%
            pointer-events: none
            top: 46%
            width: 33%
        - type: image
          entity: sensor.dryer_status
          image: /local/hassiohelp/pkg_elettrodomestici/asciugatrice_panni.png
          state_filter:
            Idle: opacity(0.0)
            Asciugatura: null
            Mantenimento: null
            Svuotare: opacity(0.0)
          style:
            transform: translate(0%,0%)
            animation: var(--my-rotate)
            animation-name: var(--my-animation-name)
            left: 14%
            pointer-events: none
            top: 31%
            width: 16%
        - type: image
          entity: sensor.dryer_status
          image: /local/hassiohelp/pkg_elettrodomestici/asciugatrice_cornice.png
          state_filter:
            Idle: opacity(0.0)
            Asciugatura: null
            Mantenimento: null
            Svuotare: opacity(0.0)
          style:
            left: 22%
            pointer-events: none
            top: 47%
            width: 19%
        - type: state-label
          entity: sensor.plug_asciugatrice_power
          prefix: '‚ö° '
          style:
            top: 0%
            left: 32%
            pointer-events: none
            transform: initial
            font-size: 12px
            line-height: 24px
            padding: 0px 14px
            color: var(--primary-text-color)
        - type: state-label
          entity: sensor.plug_asciugatrice_energy
          prefix: 'üè≠ '
          style:
            top: 0%
            left: 52%
            pointer-events: none
            transform: initial
            font-size: 12px
            line-height: 24px
            padding: 0px 14px
        - type: state-label
          entity: sensor.asciugatrice_cost
          attribute: oggi_cost
          prefix: 'üí∞ '
          suffix: ' ‚Ç¨'
          style:
            top: 0%
            left: 78%
            pointer-events: none
            transform: initial
            font-size: 12px
            line-height: 24px
            padding: 0px 14px
        - type: state-label
          entity: sensor.dryer_status
          prefix: 'Stato: '
          style:
            top: 10%
            left: 36%
            pointer-events: none
            transform: initial
            font-size: 12px
            font-weight: bold
            color: null
            line-height: 24px
            padding: 2px 2px
        - type: state-label
          entity: binary_sensor.dryer_status
          style:
            top: 10%
            left: 65%
            pointer-events: none
            transform: initial
            font-size: 12px
            line-height: 24px
            padding: 2px 22px
        - type: state-icon
          entity: binary_sensor.dryer_status
          state-color: true
          style:
            top: 10%
            left: 64%
            transform: scale(0.8)
            line-height: 24px
            padding: 0px 2px
        - type: state-label
          entity: sensor.asciugatrice_modulo_manutenzione
          prefix: 'Cicli: '
          style:
            top: 10%
            left: 84%
            pointer-events: none
            font-size: 12px
            line-height: 24px
            transform: initial
            padding: 2px 2px
        - type: custom:apexcharts-card
          style:
            '--card-background-color': rgba(0, 0, 0, 0.0)
            '--ha-card-border-width': 0px
            '--ha-card-box-shadow': none
            top: 60%
            left: 60%
            width: 50%
            font-size: 12px
          experimental:
            color_threshold: true
          apex_config:
            chart:
              height: 120px
            tooltip:
              enabled: true
            title:
              style:
                fontSize: 12px
                fontFamily: Segoe UI Light
            yaxis:
              forceNiceScale: true
              decimalsInFloat: 0
              labels:
                style:
                  fontSize: 12px
                  fontFamily: Segoe UI Light
            xaxis:
              axisBorder:
                show: true
              labels:
                show: false
                style:
                  fontSize: 12px
                  fontFamily: Segoe UI Light
            grid:
              show: true
              borderColor: rgba(112, 135, 164, 0.5)
          graph_span: 3h
          span:
            start: minute
            offset: '-3h'
          show:
            last_updated: false
          header:
            standard_format: false
            show: false
            show_states: false
            colorize_states: true
            title: Potenza
          series:
            - entity: sensor.plug_asciugatrice_power
              name: Potenza
              type: line
              stroke_width: 2
              curve: stepline
              group_by:
                func: last
                fill: last
                duration: 1m
              show:
                header_color_threshold: true
                extremas: true
                name_in_header: false
                legend_value: false
              opacity: 0.8
              color_threshold:
                - color: '#27b376'
                  value: 500
                - color: '#006f3c'
                  value: 1000
                - color: '#f9a73e'
                  value: 1500
                - color: '#bf212f'
                  value: 2300
        - type: custom:bar-card
          style:
            '--card-background-color': transparent
            '--ha-card-border-radius': 5px
            '--ha-card-box-shadow': none
            top: 56%
            left: 91%
            width: 60px
            height: 115px
          stack: horizontal
          direction: up
          positions:
            name: 'off'
            value: 'off'
            indicator: 'off'
            minmax: 'off'
            icon: 'off'
          columns: 1
          entities:
            - entity: sensor.asciugatrice_modulo_manutenzione
              max: 50
              severity:
                - color: '#27b376'
                  from: 0
                  to: 19
                - color: '#f9a73e'
                  from: 20
                  to: 39
                - color: '#bf212f'
                  from: 40
                  to: 50
        - type: state-label
          entity: input_select.asciugatrice_program
          prefix: 'Programma: '
          style:
            left: 5%
            bottom: '-3%'
            font-size: 12px
            line-height: 24px
            transform: initial
            padding: 2px 2px
        - type: icon
          icon: mdi:arrow-left-drop-circle-outline
          tap_action:
            action: call-service
            service: input_select.select_previous
            service_data:
              entity_id: input_select.asciugatrice_program
          style:
            left: 50%
            bottom: 0%
            transform: initial
            line-height: 24px
            padding: 2px 2px
        - type: icon
          icon: mdi:arrow-right-drop-circle-outline
          tap_action:
            action: call-service
            service: input_select.select_next
            service_data:
              entity_id: input_select.asciugatrice_program
          style:
            left: 56%
            bottom: 0%
            transform: initial
            line-height: 24px
            padding: 2px 2px
        - type: state-label
          entity: sensor.dryer_time_left
          style:
            right: 6%
            bottom: '-3%'
            pointer-events: none
            font-size: 12px
            transform: initial
            line-height: 24px
            padding: 2px 2px
        - type: icon
          icon: mdi:progress-clock
          entity: sensor.dryer_status
          style:
            bottom: 0%
            right: 1%
            transform: initial
            line-height: 24px
            padding: 2px 2px
  buttons:
    card:
      type: custom:mod-card
      card_mod:
        style: |
          :host {
            --grid-card-gap: 0px;
          }
      card:
        type: grid
        columns: 5
        square: false
        cards:
          - type: custom:button-card
            name: Info
            icon: mdi:information
            show_state: false
            show_label: false
            styles:
              card:
                - background-color: var('--background-color')
                - padding: 1%
                - margin-bottom: 0
                - margin-top: 0
                - border-width: 1px
                - border-radius: 0px 0px 0px 20px
                - height: 60px
                - border-color: '#4a4a4a'
                - font-size: 0.85em
              icon:
                - justify-self: center
              grid:
                - grid-template-areas: '"i" "n" "s"'
                - grid-template-columns: 1fr
                - grid-template-rows: 50% auto auto
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                data:
                  style: |-
                    --popup-min-width: 950px; 
                    --popup-max-width: 1050px;
                    --popup-border-radius: var(--ha-card-border-radius);
                  title: Dati asciugatrice
                  content:
                    type: custom:layout-card
                    layout_type: grid
                    layout:
                      grid-template-columns: 50% 50%
                      grid-template-rows: auto
                      margin: 0px 0px 0px 0px
                      grid-template-areas: |
                        "colonna1 colonna2"
                      mediaquery:
                        '(max-width: 600px)':
                          grid-template-columns: 100%
                          grid-template-areas: |
                            "colonna1"
                            "colonna2"
                    cards:
                      - type: vertical-stack
                        view_layout:
                          grid-area: colonna1
                        cards:
                          - type: entities
                            show_header_toggle: false
                            state_color: true
                            entities:
                              - entity: sensor.asciugatrice_cost
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Oggi
                                icon: mdi:counter
                                entities:
                                  - entity: sensor.asciugatrice_oggi_cicli
                                    name: Cicli
                                  - entity: sensor.asciugatrice_oggi_runtime
                                    name: Durata
                                    format: duration-h
                                  - entity: sensor.asciugatrice_oggi_energy
                                    name: Energia
                                  - attribute: oggi_cost
                                    name: Costo
                                    unit: ‚Ç¨
                              - entity: sensor.asciugatrice_cost
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Settimana
                                icon: mdi:counter
                                entities:
                                  - entity: sensor.asciugatrice_settimana_cicli
                                    name: Cicli
                                  - entity: sensor.asciugatrice_settimana_runtime
                                    name: Durata
                                    format: duration-h
                                  - entity: sensor.asciugatrice_settimana_energy
                                    name: Energia
                                  - attribute: settimana_cost
                                    name: Costo
                                    unit: ‚Ç¨
                              - entity: sensor.asciugatrice_cost
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Mese
                                icon: mdi:counter
                                entities:
                                  - entity: sensor.asciugatrice_mese_cicli
                                    name: Cicli
                                  - entity: sensor.asciugatrice_mese_runtime
                                    name: Durata
                                    format: duration-h
                                  - entity: sensor.asciugatrice_mese_energy
                                    name: Energia
                                  - attribute: mese_cost
                                    name: Costo
                                    unit: ‚Ç¨
                              - entity: sensor.asciugatrice_cost
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Anno
                                icon: mdi:counter
                                entities:
                                  - entity: sensor.asciugatrice_anno_cicli
                                    name: Cicli
                                  - entity: sensor.asciugatrice_anno_runtime
                                    name: Durata
                                    format: duration-h
                                  - entity: sensor.asciugatrice_anno_energy
                                    name: Energia
                                  - attribute: anno_cost
                                    name: Costo
                                    unit: ‚Ç¨
                              - type: divider
                              - entity: button.plug_asciugatrice_restart
                              - type: button
                                icon: mdi:restore-alert
                                name: Reset Cicli / Energia
                                action_name: Reset
                                tap_action:
                                  action: call-service
                                  service: script.reset_asciugatrice_cicli
                              - type: button
                                icon: mdi:restore-alert
                                name: Reset Valori Totali
                                action_name: Reset
                                tap_action:
                                  action: call-service
                                  service: script.reset_asciugatrice_totale
                      - type: vertical-stack
                        view_layout:
                          grid-area: colonna2
                        cards:
                          - type: entities
                            show_header_toggle: false
                            state_color: true
                            entities:
                              - entity: sensor.asciugatrice_oggi_runtime
                              - entity: sensor.asciugatrice_ultimo_runtime
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Ultimo
                                style:
                                  hui-generic-entity-row:
                                    $: |
                                      state-badge {
                                        {% set COLOR = "orange" if is_state("binary_sensor.dryer_status","on")  %}              
                                        color: {{COLOR}};
                                      } 
                                entities:
                                  - entity: sensor.asciugatrice_ultimo_runtime
                                    name: Durata
                                  - entity: sensor.asciugatrice_run_energy
                                    name: Energia
                                    unit: kWh
                                  - entity: sensor.asciugatrice_cost
                                    name: Costo
                              - entity: counter.cicli_asciugatrice
                                type: custom:multiple-entity-row
                                show_state: false
                                name: Totali
                                entities:
                                  - entity: counter.cicli_asciugatrice
                                    name: Cicli
                                  - entity: sensor.asciugatrice_total_runtime
                                    name: Durata
                                    unit: h
                                  - entity: sensor.plug_asciugatrice_total_energy
                                    name: Energia
                              - type: divider
                              - entity: binary_sensor.dryer_maintenance
                              - entity: sensor.asciugatrice_modulo_manutenzione
                              - entity: input_number.asciugatrice_ripetizioni_notifica
                              - entity: input_number.asciugatrice_avviso_manutenzione
                              - entity: input_boolean.asciugatrice_grocy_utilization
          - type: custom:button-card
            name: Settimana
            entity: sensor.asciugatrice_settimana_energy
            show_state: true
            show_label: true
            label: >
              [[[ return
              states['sensor.asciugatrice_cost'].attributes.settimana_cost + ' ‚Ç¨';
              ]]]
            styles:
              card:
                - background-color: var('--background-color')
                - padding: 1%
                - margin-bottom: 0
                - margin-top: 0
                - border-width: 1px
                - border-radius: 0px 0px 0px 0px
                - height: 60px
                - border-color: '#4a4a4a'
                - font-size: 0.85em
              grid:
                - grid-template-areas: '"n" "s" "l"'
                - grid-template-columns: 1fr
                - grid-template-rows: auto auto auto
          - type: custom:button-card
            name: Mese
            entity: sensor.asciugatrice_mese_energy
            show_state: true
            show_label: true
            label: >
              [[[ return states['sensor.asciugatrice_cost'].attributes.mese_cost +
              ' ‚Ç¨'; ]]]
            styles:
              card:
                - background-color: var('--background-color')
                - padding: 1%
                - margin-bottom: 0
                - margin-top: 0
                - border-width: 1px
                - border-radius: 0px 0px 0px 0px
                - height: 60px
                - border-color: '#4a4a4a'
                - font-size: 0.85em
              grid:
                - grid-template-areas: '"n" "s" "l"'
                - grid-template-columns: 1fr
                - grid-template-rows: auto auto auto
          - type: custom:button-card
            name: Anno
            entity: sensor.asciugatrice_anno_energy
            show_state: true
            show_label: true
            label: >
              [[[ return states['sensor.asciugatrice_cost'].attributes.anno_cost +
              ' ‚Ç¨'; ]]]
            styles:
              card:
                - background-color: var('--background-color')
                - padding: 1%
                - margin-bottom: 0
                - margin-top: 0
                - border-width: 1px
                - border-radius: 0px 0px 0px 0px
                - height: 60px
                - border-color: '#4a4a4a'
                - font-size: 0.85em
              grid:
                - grid-template-areas: '"n" "s" "l"'
                - grid-template-columns: 1fr
                - grid-template-rows: auto auto auto
          - type: custom:button-card
            name: asciugatrice
            entity: switch.plug_asciugatrice
            icon: mdi:washing-machine
            show_state: false
            show_label: false
            styles:
              card:
                - background-color: var('--background-color')
                - padding: 1%
                - margin-bottom: 0
                - margin-top: 0
                - border-width: 1px
                - border-radius: 0px 0px 20px 0px
                - height: 60px
                - border-color: '#4a4a4a'
                - font-size: 0.85em
              icon:
                - color: |
                    [[[
                      if (states['switch.plug_asciugatrice'].state== 'on')
                        return "#27b376";
                      return "#bf212f";
                    ]]]
                - justify-self: center
              grid:
                - grid-template-areas: '"i" "n" "s"'
                - grid-template-columns: 1fr
                - grid-template-rows: 50% auto auto
              tap_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  data:
                    style: |-
                      --popup-min-width: 950px; 
                      --popup-max-width: 1050px;
                      --popup-border-radius: var(--ha-card-border-radius);
                    title: Energia asciugatrice
                    content:
                      type: vertical-stack
                      cards:
                        - type: custom:bar-card
                          positions:
                            name: inside
                            value: inside
                            minmax: 'off'
                            icon: 'off'
                          height: 40px
                          columns: 5
                          entities:
                            - entity: sensor.plug_asciugatrice_apparent_power
                              name: P. apparente
                              max: 2000
                              severity:
                                - color: '#27b376'
                                  from: 0
                                  to: 99.9
                                - color: '#fl9a73e'
                                  from: 100
                                  to: 399.9
                                - color: '#bf212f'
                                  from: 400
                                  to: 1999
                            - entity: sensor.plug_asciugatrice_reactive_power
                              name: P. Reattiva
                              max: 2000
                              severity:
                                - color: '#27b376'
                                  from: 0
                                  to: 99.9
                                - color: '#fl9a73e'
                                  from: 100
                                  to: 399.9
                                - color: '#bf212f'
                                  from: 400
                                  to: 1999
                            - entity: sensor.plug_asciugatrice_power
                              name: Potenza
                              max: 2000
                              severity:
                                - color: '#27b376'
                                  from: 0
                                  to: 99.9
                                - color: '#fl9a73e'
                                  from: 100
                                  to: 399.9
                                - color: '#bf212f'
                                  from: 400
                                  to: 1999
                            - entity: sensor.plug_asciugatrice_voltage
                              name: Tensione
                              max: 255
                              severity:
                                - color: '#27b376'
                                  from: 230
                                  to: 249
                                - color: '#fl9a73e'
                                  from: 220
                                  to: 229
                                - color: rgb(163,0,0,0.80)
                                  from: 250
                                  to: 255
                            - entity: sensor.plug_asciugatrice_current
                              name: Corrente
                              max: 10
                              severity:
                                - color: '#27b376'
                                  from: 1
                                  to: 5.9
                                - color: '#fl9a73e'
                                  from: 6
                                  to: 7.9
                                - color: '#bf212f'
                                  from: 8
                                  to: 10
                        - type: grid
                          square: false
                          columns: 5
                          cards:
                            - type: statistic
                              entity: sensor.plug_asciugatrice_energy
                              name: Mese corrente
                              unit: kWh
                              period:
                                calendar:
                                  period: month
                              stat_type: change
                            - type: statistic
                              entity: sensor.plug_asciugatrice_energy
                              name: Mese - 1
                              unit: kWh
                              period:
                                calendar:
                                  period: month
                                  offset: -1
                              stat_type: change
                            - type: statistic
                              entity: sensor.plug_asciugatrice_energy
                              name: Mese - 2
                              unit: kWh
                              period:
                                calendar:
                                  period: month
                                  offset: -2
                              stat_type: change
                            - type: statistic
                              entity: sensor.plug_asciugatrice_energy
                              name: Mese - 3
                              unit: kWh
                              period:
                                calendar:
                                  period: month
                                  offset: -3
                              stat_type: change
                            - type: statistic
                              entity: sensor.plug_asciugatrice_energy
                              name: Mese - 4
                              unit: kWh
                              period:
                                calendar:
                                  period: month
                                  offset: -4
                              stat_type: change
                        - type: custom:apexcharts-card
                          experimental:
                            color_threshold: true
                          apex_config:
                            chart:
                              height: 200px
                            dataLabels:
                              enabled: true
                              dropShadow:
                                enabled: true
                            yaxis:
                              forceNiceScale: true
                              labels:
                                style:
                                  fontSize: 10px
                                  fontFamily: Segoe UI Light
                            xaxis:
                              axisBorder:
                                show: true
                              labels:
                                show: false
                                style:
                                  fontSize: 10px
                                  fontFamily: Segoe UI Light
                            grid:
                              show: true
                              borderColor: rgba(112, 135, 164, 0.5)
                          show:
                            last_updated: false
                          header:
                            standard_format: false
                            show: true
                            show_states: true
                            colorize_states: true
                            title: Consumo giornaliero - ultimi 30 giorni
                          graph_span: 30d
                          update_interval: 1h
                          series:
                            - entity: sensor.plug_asciugatrice_energy
                              name: Energia
                              type: column
                              statistics:
                                type: state
                                period: day
                                align: start
                              show:
                                datalabels: true
                                header_color_threshold: true
                                name_in_header: false
                                legend_value: false
                              opacity: 0.8
                              color_threshold:
                                - color: '#27b376'
                                  value: 0.4
                                - color: '#006f3c'
                                  value: 0.8
                                - color: '#fl9a73e'
                                  value: 1.2
                                - color: '#bf212f'
                                  value: 1.6